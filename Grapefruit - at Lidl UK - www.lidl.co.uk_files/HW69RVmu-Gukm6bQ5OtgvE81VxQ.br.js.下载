(function(){try{var t=window.$MicrosoftMaps8,i=t.Internal,u=t.SpatialDataService=t.SpatialDataService||{},r=t.GlobalConfig,y=t.LocationRect,s=t.Location,f=i._Network,e=i._Observable,p=t.PointCompression,h=t.Pushpin,c=t.Polygon,w=t.Polyline,b=i._Url,l=t.WellKnownText,k=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),a=function(){function n(){}return n.CountryRegion="CountryRegion",n.AdminDivision1="AdminDivision1",n.AdminDivision2="AdminDivision2",n.Postcode1="Postcode1",n.Postcode2="Postcode2",n.Postcode3="Postcode3",n.Postcode4="Postcode4",n.Neighborhood="Neighborhood",n.PopulatedPlace="PopulatedPlace",n}(),d=function(){function n(){}return n.getEntityDetails=function(t,i,u,f,e,o){if(r&&r.isSDK)throw new Error("is not supported for Map Control SDK users.");n._getSessionCredentials(u,function(r){n._getEntityDetailsInternal(t,i,r,f,e,o)})},n.getBoundary=function(t,i,r,u,f,e){if(!i)throw new Error("Request options are not specified.");n._getSessionCredentials(r,function(r){var s,o,h;if(i.lod=typeof i.lod=="number"?i.lod:0,i.entityType=i.entityType?i.entityType:a.CountryRegion,typeof t=="string"||t.latitude)n._getBoundaryInternal(t,i,r,u,f,e);else for(s=t,o=0,h=s.length;o<h;o++)n._getBoundaryInternal(s[o],i,r,u,f,e)})},n._getSessionCredentials=function(n,t){var r=typeof n=="string"?n:undefined,i;if(r)t(r);else if(i=n,i.getCredentials)i.getCredentials(function(n){t(n)});else throw new Error("A valid Bing Maps key must be specified.");},n._getEntityDetailsInternal=function(t,u,e,o,s,h){if(!t){h&&Microsoft.Maps.setAsync(function(){h()});return}var c=i&&i._CoreConfig&&i._CoreConfig()||{},l=c.geoEntityDataAPIEndpoint,a=l.replace("{entityId}",t).replace("{lod}",u.lod.toString()).replace("{getEntityMetaData}",(u.getEntityMetadata?1:0).toString()).replace("{culture}",u.culture?u.culture:r.dynamicProperties.market).replace("{userRegion}",u.userRegion?u.userRegion:r.dynamicProperties.userRegion).replace("{credentials}",e);f.downloadJson(a,"geodata",function(t){n._networkSuccessCallback(t,o,null,s,!1)},h,null,!1,null,!1)},n._getBoundaryInternal=function(t,u,e,o,s,h){var c;if(c=typeof t=="string"?"'"+encodeURIComponent(t)+"'":t.latitude+","+t.longitude,!c){h&&Microsoft.Maps.setAsync(function(){h()});return}var l=i&&i._CoreConfig&&i._CoreConfig()||{},a=r&&!r.isSDK?l.geoDataAPIEndpoint:l.geoDataAPISDKEndpoint,v=a.replace("{location}",c).replace("{lod}",u.lod.toString()).replace("{entityType}",u.entityType).replace("{getAllPolygons}",(u.getAllPolygons?1:0).toString()).replace("{getEntityMetaData}",(u.getEntityMetadata?1:0).toString()).replace("{culture}",u.culture?u.culture:r.dynamicProperties.market).replace("{userRegion}",u.userRegion?u.userRegion:r.dynamicProperties.userRegion).replace("{callback}","Microsoft_Maps_Network_GeoDataAPI_"+n._callbackId++).replace("{mockCallback}","mockCallback"+t.toString()).replace("{credentials}",e);f.downloadJsonp(v,"geodata",function(i){n._networkSuccessCallback(i,o,t,s,!0)},h,null,null,t)},n._networkSuccessCallback=function(n,t,i,r,u){for(var s,o,c,h,e=n.d.results,f=0,l=e.length;f<l;f++)if(e[f])for(s=e[f].Primitives,e[f].Polygons=[],o=0,c=s.length;o<c;o++){if(!u&&(s[o].IncludeCodes||s[o].ExcludeCodes)){e[f]=null;n.d.hasGeoPoliticalIssues=!0;break}h=new g(s[o].Shape);h.geometry&&h.geometry.bounds&&(r&&h.setOptions(r),e[f].Polygons.push(h))}n.d.location=i;t&&t(n.d)},n._callbackId=1,n}(),g=function(n){function t(t){var i=n.call(this,[new s(0,0)],null)||this;return i.setArea(i._parse(t),i.getGeneralizable()),i}return k(t,n),t.prototype._parse=function(n){for(var r=[],u=n,t=u.split(","),f=t.length,i=1,f=t.length;i<f;i++)r.push(p.decode(t[i]));return r},t}(c),nt=function(){function t(n,t,i){this._property=n;this._operator=t;this._value=i}return t.prototype.toString=function(){var r=Object.prototype.toString.call(this._value),i;if(r==="[object String]")i="'"+t._encodeODataString(this._value.toString())+"'";else if(r==="[object Date]")i=t._getUTCDateFilter(this._value);else if(r==="[object Array]"){if(this._operator===n.isIn)return this._property+"%20"+this._operator+"('"+this._value.join("','")+"')";throw new Error("Filter values of type Array can only use the isIn filter operator.");}else this._value&&(i=this._value.toString());return this._operator===n.startsWith||this._operator===n.endsWith?this._operator+"("+this._property+","+i+")%20eq%20true":this._property+"%20"+this._operator+"%20"+i},t.prototype.execute=function(t){var i=t[this._property],o,f,r,c;if(this._property.indexOf(".")>=0){if(f=this._property.split("."),o=f.length,o>0)for(i=t[f[0]],r=1;r<o;r++)i=i[f[r]]}else i=t[this._property];var u=Object.prototype.toString.call(this._value)==="[object String]",s=Object.prototype.toString.call(this._value)==="[object Array]",h=Object.prototype.toString.call(this._value)==="[object Object]";switch(this._operator){case n.equals:return s||h?e.areEqual(i,this._value):i===this._value;case n.notEquals:return s||h?!e.areEqual(i,this._value):i!=this._value;case n.greaterThan:return i>this._value;case n.greaterThanOrEqual:return i>=this._value;case n.lessThan:return i<this._value;case n.lessThanOrEqual:return i<=this._value;case n.endsWith:if(u)return i.indexOf(this._value,i.length-this._value.length)!==-1;break;case n.notEndsWith:if(u)return i.indexOf(this._value,i.length-this._value.length)===-1;break;case n.startsWith:if(u)return i.indexOf(this._value)===0;break;case n.notStartsWith:if(u)return i.indexOf(this._value)!=0;break;case n.isIn:if(s){for(r=0,c=this._value.length;r<c;r++)if(e.areEqual(this._value[r],i))return!0;return!1}if(u)return this._value.indexOf(i)>=0}return!1},t._getUTCDateFilter=function(n){var t,i,r,u,f;return n?(t=(n.getUTCMonth()+1).toString(),t=t.length===1?"0"+t:t,i=n.getUTCDate().toString(),i=i.length===1?"0"+i:i,r=n.getUTCHours().toString(),r=r.length===1?"0"+r:r,u=n.getUTCMinutes().toString(),u=u.length===1?"0"+u:u,f=n.getUTCSeconds().toString(),f=f.length===1?"0"+f:f,["datetime'",n.getUTCFullYear(),"-",t,"-",i,"T",r,":",u,":",f,"Z'"].join("")):""},t._encodeODataString=function(n){return encodeURIComponent(n).replace(/'/g,"''")},t}(),n=function(){function n(){}return n.startsWith="startsWith",n.endsWith="endsWith",n.notStartsWith="not startsWith",n.notEndsWith="not endsWith",n.equals="eq",n.notEquals="ne",n.greaterThan="gt",n.greaterThanOrEqual="ge",n.lessThan="lt",n.lessThanOrEqual="le",n.isIn="in",n}(),o=function(){function n(){}return n.and="and",n.or="or",n}(),tt=function(){function n(n,t,i){this._filters=n?n:[];this._operator=t;this._not=i}return n.prototype.toString=function(){return(this._not?"not ":"")+"("+this._filters.join("%20"+this._operator+"%20")+")"},n.prototype.execute=function(n){var r=this._filters.length,t,i;if(r>0){if(t=this._filters[0].execute(n),this._operator===o.and)for(i=1;i<r;i++)t=t&&this._filters[i].execute(n);else if(this._operator===o.or)for(i=1;i<r;i++)t=t||this._filters[i].execute(n);return this._not&&(t=!t),t}return!1},n}(),it=function(){function n(){}return n.search=function(t,i,r,u,f){if(t.select){var e=t.select;e.indexOf("Latitude")<0&&e.push("Latitude");e.indexOf("Longitude")<0&&e.push("Longitude")}rt.buildUrl(t,i,function(t){n._makeRequest(t,r,u,function(n,t,i){f&&f(t,i)})})},n._makeRequest=function(t,i,r,u){var e=decodeURIComponent(t.toString());e=e.replace("{callback}","Microsoft_Maps_Network_QueryAPI_"+n._callbackId++);f.downloadJsonp(e,"queryapi",function(t){i&&i(n._constructPrimitives(t.d.results,r),t.d.__count)},u)},n._constructPrimitives=function(t,i){var d=[],a,u,c,r,e,v,nt,k,y,p,tt,f;if(t&&t.length){var g=t[0],o=Object.keys(g),w,b=[];for(u=0,c=o.length;u<c;u++)a=g[o[u]],typeof a=="string"&&(n._isWKT(a)?w=o[u]:n._parseBingJsonDate(a)&&b.push(o[u]));for(u=0,c=t.length;u<c;u++){for(r=t[u],e=w?l.read(r[w],i):new h(new s(r.Latitude,r.Longitude),i?i.pushpinOptions:undefined),v=0,nt=b.length;v<nt;v++)k=b[v],r[k]=n._parseBingJsonDate(r[k]);if(e)for(y=[],y=e.length?e:[e],p=0,tt=y.length;p<tt;p++)f=y[p],f.entity&&typeof f.entity.collisionBehavior=="number"&&(r.collisionBehavior=f.entity.collisionBehavior),f.metadata=r,f.setOptions({draggable:r.draggable,icon:r.icon,visible:r.visible,title:r.title,subTitle:r.subTitle,enableHoverStyle:r.enableHoverStyle,enableClickedStyle:r.enableHoverStyle,text:r.text,color:r.color,cursor:r.cursor,fillColor:r.fillColor,strokeColor:r.strokeColor,strokeThickness:r.strokeThickness,strokeDashArray:r.strokeDashArray,generalizable:r.generalizable}),d.push(f)}}return d},n._isWKT=function(n){return/^(GeometryCollection\()?((Point|LineString|Polygon|Multipoint|MultiLineString|MultiPolygon|GeometryCollection)\s*\(+[-0-9\.,\s\(\)\r\n]+\)*)+\)+[\s\r\n]*$/i.test(n)},n._parseBingJsonDate=function(n){var t;return/Date\(([-+]?\d+)\)/.test(n)?(t=parseInt(n.replace("/Date(","").replace(")/",""),10),new Date((t-621355968000000000)/1e4)):null},n._callbackId=1,n}(),rt=function(){function n(){}return n.buildUrl=function(t,i,r){n._validateOptions(t);n._retrieveKey(i,function(i){var e=t.spatialFilter,u=null,f,o;if(e)switch(e.spatialFilterType){case"nearby":u=n._buildUrlForFindNearbyQuery(t,i);break;case"nearRoute":u=n._buildUrlForFindNearRoute(t,i);break;case"intersects":f=e.intersects;typeof f=="string"?u=n._buildUrlForIntersectText(t,i,f):f instanceof y?u=n._buildUrlForFindByBoundingBoxQuery(t,i):f instanceof c||f instanceof h||f instanceof w?(o=l.write(f),u=n._buildUrlForIntersectText(t,i,o)):u=n._buildBaseUrl(t,!0,!1,i)}u||(u=n._buildBaseUrl(t,!0,!1,i));r&&r(u)})},n._buildUrlForFindByBoundingBoxQuery=function(t,i){var u=n._buildBaseUrl(t,!0,!1,i),f=t.spatialFilter,r=f.intersects;return u.queryStringParameters.spatialFilter="bbox({south},{west},{north},{east})".replace("{south}",(Math.round(r.getSouth()*1e4)/1e4).toString()).replace("{west}",(Math.round(r.getWest()*1e4)/1e4).toString()).replace("{north}",(Math.round(r.getNorth()*1e4)/1e4).toString()).replace("{east}",(Math.round(r.getEast()*1e4)/1e4).toString()),u},n._buildUrlForFindNearbyQuery=function(t,i){var u=n._buildBaseUrl(t,!0,!1,i),f=t.spatialFilter,r=f.radius;return r<.16&&(r=.16),r>1e3&&(r=1e3),u.queryStringParameters.spatialFilter="nearby({location},{distanceInKm})".replace("{location}",n._formatLocation(f.location,!1)).replace("{distanceInKm}",r.toString()),u},n._buildUrlForFindNearRoute=function(t,i){var f=n._buildBaseUrl(t,!0,!1,i),r=t.spatialFilter,e=n._formatLocation(r.start,!0),o=n._formatLocation(r.end,!0),u=f.queryStringParameters;return r.travelMode&&r.travelMode!=="Driving"?u.travelMode="Walking":(u.travelMode="Driving",r.avoid&&r.avoid.length>0&&(u.avoid=r.avoid.join(",")),r.distanceBeforeFirstTurn>0&&(u.dbft=r.distanceBeforeFirstTurn.toString()),r.heading&&r.heading>0&&r.heading<360&&(u.hd=r.heading.toString())),u.optmz=r.optimize?r.optimize:"time",u.spatialFilter="nearRoute({start},{end})".replace("{start}",e).replace("{end}",o),f},n._buildUrlForIntersectText=function(t,i,r){var u=n._buildBaseUrl(t,!0,!1,i);return u.queryStringParameters.spatialFilter="intersects('{0}')".replace("{0}",r),u},n._formatLocation=function(n,t){if(typeof n=="string")return"'{0}'".replace("{0}",encodeURIComponent(n));var i=t?"'{0},{1}'":"{0},{1}";return i.replace("{0}",(Math.round(n.latitude*1e4)/1e4).toString()).replace("{1}",(Math.round(n.longitude*1e4)/1e4).toString())},n._buildBaseUrl=function(n,t,i,r){var e=n.queryUrl,f=b.fromString(e),u=f.queryStringParameters={};return u.$select=n.select?n.select.join(","):"*",t&&(u.$select+=",__Distance"),n.orderBy&&(u.$orderby=n.orderBy.join(",")),n.isStaging&&(u.isStaging="1"),i||(n.top&&(u.$top=n.top.toString()),n.skip&&(u.$skip=n.skip.toString()),n.inlineCount&&(u.$inlinecount="allpages"),n.filter&&(u.$filter=n.filter.toString())),u.key=r,u.$format="json",u.jsonp="{callback}",f},n._retrieveKey=function(n,t){var r=typeof n=="string"?n:undefined,i;if(r)t&&t(r);else if(i=n,i.getCredentials)i.getCredentials(function(n){t&&t(n)});else throw new Error("A valid Bing Maps key must be specified.");},n._validateOptions=function(n){var t,i,r,u;if(!n)throw new Error("Query options not specified");if(!n.queryUrl)throw new Error("Query URL is not specified");if(n.spatialFilter){if(!n.spatialFilter.spatialFilterType)throw new Error("Spatial filter type should be specified");if(t=n.spatialFilter.spatialFilterType,t!=="nearby"&&t!=="nearRoute"&&t!=="intersects")throw new Error("spatialfiltertype should be one of the following:nearby,nearRoute,intersects");if(t==="nearby"){if(i=n.spatialFilter,!i.location)throw new Error("Location needs to be specified when the spatialfiltertype is nearby");if(!i.radius)throw new Error("Radius needs to be specified when the spatialfiltertype is nearby");}if(t==="nearRoute"){if(r=n.spatialFilter,!r.start)throw new Error("Start Location needs to be specified when the spatialfiltertype is nearRoute");if(!r.end)throw new Error("End Location needs to be specified when the spatialfiltertype is nearRoute");}if(t==="intersects"&&(u=n.spatialFilter,!u.intersects))throw new Error("Intersection needs to be specified when the spatialfiltertype is intersects");}},n}();u.FilterCompareOperator=n;u.FilterLogicalOperator=o;u.FilterGroup=tt;u.Filter=nt;u.BoundaryEntityTypes=a;u.GeoDataAPIManager=d;u.QueryAPIManager=it}catch(v){if(t.logger)t.logger.logCriticalError(v);else throw v;}}).call(window)